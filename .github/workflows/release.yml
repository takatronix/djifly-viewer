name: Release

on:
  push:
    tags:
      - 'v*' # v1.0.0, v2.1.3のようなタグが作成されたときに実行

jobs:
  release:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install
      
    - name: Build for macOS and Windows
      run: |
        npm run build-mac
        npm run build-win
      
    - name: List dist files
      run: ls -la dist/
      
    - name: Get version from tag
      id: get_version
      run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
      
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.get_version.outputs.VERSION }}
        name: Release ${{ steps.get_version.outputs.VERSION }}
        body: |
          ## New Features
          - 🔄 Universal DJI device support (not just DJI Goggles 3)
          - 🌐 Multi-language support (English/Japanese) with language preference saving
          - 📖 Enhanced connection guide with step-by-step images
          - 🎨 Cleaner UI without emojis in buttons
          - 🔒 Hidden port numbers for simplified user experience
          
          ## Downloads
          - **macOS Intel**: Download the `.dmg` file
          - **macOS Apple Silicon**: Download the `-arm64.dmg` file
          - **Windows**: Download the `.exe` file
          
          ## Installation
          1. Download the appropriate file for your system
          2. Install the application
          3. Run the application and follow the connection guide
          
          ## What's Changed
          See the commit history for detailed changes.
          
        files: |
          dist/DJI Fly Stream Viewer-*.dmg
          dist/DJI Fly Stream Viewer Setup *.exe
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}