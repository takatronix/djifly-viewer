<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJI Fly Stream Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header-row" style="display: flex; align-items: center; justify-content: space-between;">
            <h1 style="margin: 0 auto; display: flex; align-items: center; justify-content: center; flex: 1; text-align: center;">
                <img src="icon.png" alt="DJI Icon" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 10px;">DJI Fly Stream Viewer
            </h1>
            <div style="display: flex; gap: 8px; margin-left: auto;">
                <button id="languageToggle" class="dji-button" style="font-size: 14px; padding: 6px 12px;">ğŸŒ EN</button>
                <button id="djiGoggles3Btn" class="dji-button" data-i18n="connectionGuide">âš™ï¸ Connection Guide</button>
            </div>
        </div>
        
        <!-- ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
        <div class="controls-row status-group">
            <!-- RTMP URL -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <span class="label">RTMP URL:</span>
                <code id="rtmpUrl" onclick="copyRtmpUrl()" style="border: 2px solid #1976d2; background: #e3f2fd; color: #0d47a1; padding: 4px 12px; border-radius: 5px; font-weight: bold; font-size: 1.05em; cursor: pointer;" data-i18n="loading">Loading...</code>
                <button class="help-button" id="rtmpHelp" data-i18n-title="rtmpHelp" title="RTMP URL Help">?</button>
            </div>
            
            <!-- å“è³ªé¸æŠ -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <span class="label" data-i18n="quality">Quality:</span>
                <select id="modeSelect">
                    <option value="original" data-i18n="standardQuality">ğŸ¥ Standard Quality (1080p)</option>
                    <option value="low_720p" data-i18n="enhanced720p">âš¡ Enhanced 720p</option>
                    <option value="low_480p" data-i18n="enhanced480p">âš¡ Enhanced 480p</option>
                </select>
            </div>
            

            
            <!-- çŠ¶æ…‹è¡¨ç¤º (ä¸€ç•ªå³) -->
            <div class="status-indicator-group" style="margin-left: auto; display: flex; align-items: flex-end;">
                <span class="label" style="font-size: 0.8em;" data-i18n="status">Status:</span>
                <span id="status" class="value" style="font-size: 0.8em;" data-i18n="disconnected">Disconnected</span>
            </div>
        </div>

        <div class="video-container">
            <video id="videoPlayer" controls autoplay muted playsinline></video>
        </div>

        <!-- ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
        <div class="debug-info" style="margin-top: 10px; padding: 8px; background: rgba(42, 42, 42, 0.6); border-radius: 6px; font-family: monospace; font-size: 11px;">
            <div style="color: #4a9eff;">ğŸ” <span data-i18n="debug">Debug</span>: <span id="flvStatus" data-i18n="checking">Checking...</span> | <span data-i18n="player">Player</span>: <span id="playerStatus" data-i18n="uninitialized">Uninitialized</span></div>
        </div>
    </div>

    <!-- ãƒ­ã‚°ãƒ‘ãƒãƒ« -->
    <div id="logPanel" class="log-panel">
        <div class="log-header">
            <span>ğŸ“‹ <span data-i18n="systemLog">System Log</span></span>
            <div class="log-controls">
                <button id="clearLogBtn" data-i18n-title="clearLog" title="Clear Log">ğŸ—‘ï¸</button>
                <button id="toggleLogBtn" data-i18n-title="toggleLog" title="Toggle Log Panel">â–¼</button>
            </div>
        </div>
        <div id="logContent" class="log-content"></div>
        <div id="logResizer" class="log-resizer"></div>
    </div>

    <script src="flv.min.js?v=1"></script>
    <script>
        // å¤šè¨€èªå¯¾å¿œãƒ‡ãƒ¼ã‚¿
        const translations = {
            en: {
                connectionGuide: "âš™ï¸ Connection Guide",
                loading: "Loading...",
                rtmpHelp: "RTMP URL Help",
                quality: "Quality:",
                standardQuality: "ğŸ¥ Standard Quality (1080p)",
                enhanced720p: "âš¡ Enhanced 720p", 
                enhanced480p: "âš¡ Enhanced 480p",
                status: "Status:",
                disconnected: "Disconnected",
                debug: "Debug",
                checking: "Checking...",
                player: "Player",
                uninitialized: "Uninitialized",
                systemLog: "System Log",
                clearLog: "Clear Log",
                toggleLog: "Toggle Log Panel",
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                connected: "Connected",
                connecting: "Connecting...",
                error: "Error",
                stopped: "Stopped",
                preparing: "Preparing...",
                ready: "Ready",
                streaming: "Streaming",
                metadataReceived: "Metadata Received",
                loadingComplete: "Loading Complete",
                resetComplete: "Reset Complete",
                playerInitializing: "Player Initializing...",
                playerError: "Player Error",
                streamNotFound: "Stream Not Found",
                videoElementNotFound: "Video Element Not Found",
                streamUrlNotSet: "Stream URL Not Set",
                rtmpUrlCopied: "RTMP URL copied to clipboard!",
                copyFailed: "Failed to copy URL",
                flvLibraryError: "flv.js library error - please reload the page",
                browserNotSupported: "This browser does not support FLV playback",
                flvLibraryAvailable: "flv.js is available",
                streamDetected: "Stream detected - auto connecting...",
                streamEnded: "Stream ended",
                autoplayFailed: "Auto-play failed: click play button manually"
            },
            ja: {
                connectionGuide: "âš™ï¸ æ¥ç¶šæ–¹æ³•",
                loading: "èª­ã¿è¾¼ã¿ä¸­...",
                rtmpHelp: "RTMP URLã®ãƒ˜ãƒ«ãƒ—",
                quality: "å“è³ª:",
                standardQuality: "ğŸ¥ æ¨™æº–å“è³ª (1080p)",
                enhanced720p: "âš¡ ä½é…å»¶ 720p",
                enhanced480p: "âš¡ ä½é…å»¶ 480p", 
                status: "çŠ¶æ…‹:",
                disconnected: "æœªæ¥ç¶š",
                debug: "ãƒ‡ãƒãƒƒã‚°",
                checking: "ãƒã‚§ãƒƒã‚¯ä¸­...",
                player: "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼",
                uninitialized: "æœªåˆæœŸåŒ–",
                systemLog: "ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°",
                clearLog: "ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢",
                toggleLog: "ãƒ­ã‚°ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€",
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                connected: "æ¥ç¶šæ¸ˆã¿",
                connecting: "æ¥ç¶šä¸­...",
                error: "ã‚¨ãƒ©ãƒ¼",
                stopped: "åœæ­¢",
                preparing: "æº–å‚™ä¸­...",
                ready: "æº–å‚™å®Œäº†",
                streaming: "å†ç”Ÿä¸­",
                metadataReceived: "ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å—ä¿¡å®Œäº†",
                loadingComplete: "èª­ã¿è¾¼ã¿å®Œäº†",
                resetComplete: "ãƒªã‚»ãƒƒãƒˆå®Œäº†",
                playerInitializing: "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸåŒ–ä¸­...",
                playerError: "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆã‚¨ãƒ©ãƒ¼",
                streamNotFound: "ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
                videoElementNotFound: "ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
                streamUrlNotSet: "ã‚¹ãƒˆãƒªãƒ¼ãƒ URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“",
                rtmpUrlCopied: "RTMP URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼",
                copyFailed: "URLã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ",
                flvLibraryError: "flv.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ãƒ©ãƒ¼ - ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„",
                browserNotSupported: "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯FLVå†ç”Ÿã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“",
                flvLibraryAvailable: "flv.js ãŒæ­£å¸¸ã«åˆ©ç”¨å¯èƒ½ã§ã™",
                streamDetected: "ã‚¹ãƒˆãƒªãƒ¼ãƒ æ¤œå‡º - è‡ªå‹•æ¥ç¶šä¸­...",
                streamEnded: "ã‚¹ãƒˆãƒªãƒ¼ãƒ çµ‚äº†",
                autoplayFailed: "æ‰‹å‹•ã§å†ç”Ÿãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯"
            }
        };

        // ç¾åœ¨ã®è¨€èªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‹±èªï¼‰
        let currentLanguage = localStorage.getItem('language') || 'en';

        // è¨€èªåˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ja' : 'en';
            localStorage.setItem('language', currentLanguage);
            updateLanguage();
            updateLanguageButton();
        }

        // è¨€èªæ›´æ–°é–¢æ•°
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // data-i18nå±æ€§ã‚’æŒã¤è¦ç´ ã‚’æ›´æ–°
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (t[key]) {
                    if (element.tagName === 'OPTION') {
                        element.textContent = t[key];
                    } else {
                        element.textContent = t[key];
                    }
                }
            });

            // data-i18n-titleå±æ€§ã‚’æŒã¤è¦ç´ ã®titleæ›´æ–°
            document.querySelectorAll('[data-i18n-title]').forEach(element => {
                const key = element.getAttribute('data-i18n-title');
                if (t[key]) {
                    element.title = t[key];
                }
            });

            // htmlè¦ç´ ã®langå±æ€§æ›´æ–°
            document.documentElement.lang = currentLanguage;
        }

        // è¨€èªãƒœã‚¿ãƒ³æ›´æ–°
        function updateLanguageButton() {
            const button = document.getElementById('languageToggle');
            if (button) {
                button.textContent = currentLanguage === 'en' ? 'ğŸŒ EN' : 'ğŸŒ æ—¥æœ¬èª';
            }
        }

        // ç¿»è¨³é–¢æ•°ï¼ˆJavaScriptã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰
        function t(key) {
            return translations[currentLanguage][key] || key;
        }

        // åˆæœŸåŒ–
        updateLanguage();
        updateLanguageButton();

        // è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('languageToggle').addEventListener('click', toggleLanguage);

        // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
        const flvStatusElement = document.getElementById('flvStatus');
        const playerStatusElement = document.getElementById('playerStatus');
        
        function updateDebugInfo() {
            if (flvStatusElement) {
                flvStatusElement.textContent = typeof flvjs !== 'undefined' ? 'OK' : 'ERROR';
                flvStatusElement.style.color = typeof flvjs !== 'undefined' ? '#4aff4a' : '#ff4a4a';
            }
            if (playerStatusElement) {
                const hasPlayer = window.flvPlayer !== null && window.flvPlayer !== undefined;
                playerStatusElement.textContent = hasPlayer ? 'OK' : 'NULL';
                playerStatusElement.style.color = hasPlayer ? '#4aff4a' : '#ff4a4a';
            }
        }
        
        // åˆæœŸæ›´æ–°
        updateDebugInfo();
        
        // 1ç§’æ¯ã«æ›´æ–°
        setInterval(updateDebugInfo, 1000);
        
        // flv.js ãƒã‚§ãƒƒã‚¯
        if (typeof flvjs === 'undefined') {
            console.error('âŒ flv.js failed to load');
            document.body.innerHTML += `<div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:red;color:white;padding:20px;border-radius:10px;z-index:9999;font-weight:bold;">âš ï¸ ${t('flvLibraryError')}</div>`;
        } else {
            console.log('âœ… flv.js loaded successfully');
        }
    </script>
    <script src="app.js"></script>
</body>
</html>