<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJI Fly Stream Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header-row" style="display: flex; align-items: center; justify-content: space-between;">
            <h1 style="margin: 0 auto; display: flex; align-items: center; justify-content: center; flex: 1; text-align: center;">
                <img src="icon.png" alt="DJI Icon" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 10px;">DJI Fly Stream Viewer
            </h1>
            <button id="djiGoggles3Btn" class="dji-button" style="margin-left: auto;">âš™ï¸ æ¥ç¶šæ–¹æ³•</button>
        </div>
        
        <!-- ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
        <div class="controls-row status-group">
            <!-- RTMP URL -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <span class="label">RTMP URL:</span>
                <code id="rtmpUrl" onclick="copyRtmpUrl()" style="border: 2px solid #1976d2; background: #e3f2fd; color: #0d47a1; padding: 4px 12px; border-radius: 5px; font-weight: bold; font-size: 1.05em; cursor: pointer;">èª­ã¿è¾¼ã¿ä¸­...</code>
                <button class="help-button" id="rtmpHelp" title="RTMP URLã®ãƒ˜ãƒ«ãƒ—">?</button>
            </div>
            
            <!-- å“è³ªé¸æŠ -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <span class="label">å“è³ª:</span>
                <select id="modeSelect">
                    <option value="original">ğŸ¥ æ¨™æº–å“è³ª (1080p)</option>
                    <option value="low_720p">âš¡ ä½é…å»¶ 720p</option>
                    <option value="low_480p">âš¡ ä½é…å»¶ 480p</option>
                </select>
            </div>
            

            
            <!-- çŠ¶æ…‹è¡¨ç¤º (ä¸€ç•ªå³) -->
            <div class="status-indicator-group" style="margin-left: auto; display: flex; align-items: flex-end;">
                <span class="label" style="font-size: 0.8em;">çŠ¶æ…‹:</span>
                <span id="status" class="value" style="font-size: 0.8em;">æœªæ¥ç¶š</span>
            </div>
        </div>

        <div class="video-container">
            <video id="videoPlayer" controls autoplay muted playsinline></video>
        </div>

        <!-- ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
        <div class="debug-info" style="margin-top: 10px; padding: 8px; background: rgba(42, 42, 42, 0.6); border-radius: 6px; font-family: monospace; font-size: 11px;">
            <div style="color: #4a9eff;">ğŸ” ãƒ‡ãƒãƒƒã‚°: <span id="flvStatus">ãƒã‚§ãƒƒã‚¯ä¸­...</span> | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: <span id="playerStatus">æœªåˆæœŸåŒ–</span></div>
        </div>
    </div>

    <!-- ãƒ­ã‚°ãƒ‘ãƒãƒ« -->
    <div id="logPanel" class="log-panel">
        <div class="log-header">
            <span>ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</span>
            <div class="log-controls">
                <button id="clearLogBtn" title="ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢">ğŸ—‘ï¸</button>
                <button id="toggleLogBtn" title="ãƒ­ã‚°ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€">â–¼</button>
            </div>
        </div>
        <div id="logContent" class="log-content"></div>
        <div id="logResizer" class="log-resizer"></div>
    </div>

    <script src="flv.min.js?v=1"></script>
    <script>
        // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
        const flvStatusElement = document.getElementById('flvStatus');
        const playerStatusElement = document.getElementById('playerStatus');
        
        function updateDebugInfo() {
            if (flvStatusElement) {
                flvStatusElement.textContent = typeof flvjs !== 'undefined' ? 'OK' : 'ERROR';
                flvStatusElement.style.color = typeof flvjs !== 'undefined' ? '#4aff4a' : '#ff4a4a';
            }
            if (playerStatusElement) {
                const hasPlayer = window.flvPlayer !== null && window.flvPlayer !== undefined;
                playerStatusElement.textContent = hasPlayer ? 'OK' : 'NULL';
                playerStatusElement.style.color = hasPlayer ? '#4aff4a' : '#ff4a4a';
            }
        }
        
        // åˆæœŸæ›´æ–°
        updateDebugInfo();
        
        // 1ç§’æ¯ã«æ›´æ–°
        setInterval(updateDebugInfo, 1000);
        
        // flv.js ãƒã‚§ãƒƒã‚¯
        if (typeof flvjs === 'undefined') {
            console.error('âŒ flv.js failed to load');
            document.body.innerHTML += '<div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:red;color:white;padding:20px;border-radius:10px;z-index:9999;font-weight:bold;">âš ï¸ flv.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ<br/><br/>ğŸ”„ ãƒšãƒ¼ã‚¸ã‚’å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰ (Ctrl+F5) ã—ã¦ãã ã•ã„</div>';
        } else {
            console.log('âœ… flv.js loaded successfully');
        }
    </script>
    <script src="app.js"></script>
</body>
</html>